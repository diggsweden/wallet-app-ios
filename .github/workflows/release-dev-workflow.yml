# SPDX-FileCopyrightText: 2025 Digg - Agency for Digital Government
#
# SPDX-License-Identifier: CC0-1.0

# Release Dev Workflow
#
# This workflow builds the iOS app and uploads to TestFlight for testing.
# Triggered manually via workflow_dispatch (GitHub Actions UI).
#
# How to use:
# 1. Go to Actions tab in GitHub
# 2. Select "Release Dev Workflow"
# 3. Click "Run workflow"
# 4. Select branch to build from
# 5. Click "Run workflow"
#
# Created artifacts:
# - IPA uploaded to TestFlight

name: Release Dev Workflow

on:
  workflow_dispatch:

concurrency:
  group: release-dev-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: read

jobs:
  build:
    uses: diggsweden/reusable-ci/.github/workflows/build-xcode-ios.yml@12603231353981dadbe2c56a056e611528f29a15 # v2.4.3
    permissions:
      contents: read
    secrets: inherit
    with:
      xcode-version: "26.0.1"
      scheme: "Wallet Demo"
      project: "Wallet.xcodeproj"
      configuration: Release
      enable-code-signing: true
      export-options-var: EXPORT_OPTIONS_BASE64
      artifact-name: wallet-ios-demo-dev

  upload-testflight:
    needs: build
    uses: diggsweden/reusable-ci/.github/workflows/publish-apple-appstore.yml@12603231353981dadbe2c56a056e611528f29a15 # v2.4.3
    permissions:
      contents: read
    secrets: inherit
    with:
      ipa-artifact-name: wallet-ios-demo-dev
      submit-for-review: false
      skip-validation: false
